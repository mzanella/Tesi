\documentclass[../Tesi.tex]{subfiles}

\begin{document}
	\section{Descrizione delle classi principali}
	Di seguito vengono riportate le descrizioni delle classi più importanti dell'applicazione.

		\subsection{dependency\_injection::AppModule}
		La classe \mclass{AppModule} si occupa della risoluzione delle dipendenze per permettere l'utilizzo della dependency injection. La libreria Dagger 2 utilizza i metodi di \mclass{AppModule} con l'annotazione \textit{@Provides} per l'inizializzazione dei campi dati annotati con \textit{@Inject} delle varie classi dell'applicazione. Questo meccanismo è utilizzato per far corrispondere per ogni campo dati che ha come tipo un interfaccia, l'istanza di una classe che implementa tale interfaccia.

		\subsection{model::dao::Content}
		La classe \mclass{Content} è utilizzata per la gestione dei contenuti xAPI, di cui l'applicazione deve permettere la fruizione. Gli oggetti di tale classe rappresentano una entry nella relazione \textit{Content} nel database locale. Per questo motivo gli attributi della relazione \textit{Content} e i campi dati della relazione omonima corrispondono. La classe \mclass{Content} estende la classe \mclass{RealmObject}, fornita dalla libreria Realm. Grazie a ciò è possibile modificare i campi dati di un oggetto di tipo \mclass{Content}, ripercuotendo tali modifiche sulla entry corrispondente del database locale. In modo analogo anche le classi \mclass{ContentVersion}, \mclass{LrsData}, \mclass{History} e \mclass{UserData} estendono \mclass{RealmObject}, permettendo quindi le modifiche ai valori della relazione con nome corrispondente.

		\subsection{model::data\_access::DatabaseAccess}
		La classe \mclass{DataAccess} è utilizzata per la gestione dei dati del database riguardanti i contenuti e i dati di fruizione ad essi associati. Tale classe implementa le interfacce \minterface{ContentDataAccess} e \minterface{ContentHistoryForLoggedUserAccess} le quali espongono, rispettivamente, i metodi per l'inserimento, recupero e modifica dei contenuti xAPI trattati dall'applicazione e dei dati di fruizione di un determinato contenuto da parte dell'utente loggato. Tale classe in particolare si occupa anche di inserire nel database del dispositivo i dati dei contenuti da visualizzare nell'applicazione.

		\subsection{model::data\_access::StatementSenderImp}
		La classe \mclass{StatementSenderImp} si occupa della gestione e dell'invio degli statement ottenuti dall'interazione di un utente con i contenuti xAPI al LRS. Tale classe implementa l'interfaccia \minterface{StatementSender}, che a sua volta estende le interfacce \minterface{DatabaseChangeListener} e \minterface{NetworkCHangeListener}. L'interfaccia \minterface{StatementSender} espone i metodi che devono essere implementati al fine di permettere l'invio degli statement ad un LRS. Le interfacce \minterface{DatabaseChangeListener} e \minterface{NetworkCHangeListener} permettono, invece, agli oggetti di tale classe di registrarsi come ``listener'' dei cambiamenti nel database degli statement, gestito dalla libreria TinCanAndroid-Offline, e nella connettività ad internet del dispositivo. Nel caso in cui sia presente una connessione internet e vi siano statement non inviati al LRS tale classe provvederà ad inviarli, eliminandoli dal database della libreria TinCanAndroid-Offline. Per fare questo gli oggetti a tale classe hanno un riferimento ad un oggetto di tipo \mclass{RSTinCanOfflineConnector}. Tale oggetto, della libreria TinCanAndroid-Offline, permette sia l'accesso al database degli statement, sia l'invio di quest'ultimi al LRS.

		\subsection{model::lrs\_access::LrsSynchronizeImp}
		La classe \mclass{LrsSynchronizeImp} si occupa di effettuare delle richieste al LRS per 
		il recupero di dati di fruizione di un utente che non sono presenti localmente. Gli oggetti di questa classe recuperano gli URL per la comunicazione con LRS sfruttando un oggetto sottotipo dell'interfaccia \minterface{LrsRequestUrl}. Nel caso sia disponibile una connessione ad internet, le istanze di questa classe si occupano di effettuare le richieste per recuperare le informazioni desiderate dal LRS. Le informazioni ricavate dalla risposta del LRS sono usate per aggiornare i dati di fruizione di un determinato utente, presenti nel database locale, utilizzando un oggetto di tipo \minterface{ContentHistoryForLoggedUserAccess}. Dal momento che è stato deciso di far uso di Learning Locker come LRS, le risposte ottenute sono in formato JSON e vengono gestite utilizzando la libreria Gson.

		\subsection{model::result::StartResult}
		La classe \mclass{StartResult} è impiegata per ricavare le informazioni che vengono inviate dallo script JavaScript, che si occupa di ricavare i dati di fruizione di un utente, riguardo all'inizio di un certo contenuto, da parte di un utente. Il codice di tale classe è generato sfruttando la libreria Google AutoValue. Praticamente questa libreria si occupa di implementare i metodi delle classi che hanno l'annotazione \textit{@AutoValue}, fornendo anche la possibilità di creare una classe interna ``Builder'', per l'implementazione del design pattern Builder appunto. Il programmatore non deve far altro che dichiarare la classe che si vuole creare e la una classe interna \mclass{Builder} come astratte, dichiarare tutti i metodi getter per i campi dati, anch'essi astratti, e dichiarare i metodi della classe \mclass{Builder} per settare i campi dati, sempre astratti. Le istanze di questa classe vengono create sfruttando un oggetto \mclass{JsonObject}, il quale contiene le informazioni ricavate dallo script JavaScript. Anche le classi \mclass{PartialResult} e \mclass{TotalResult} sono state create utilizzando la libreria Google AutoValue e hanno scopi simili alla classe \mclass{StartResult}.

		\subsection{model::statement\_object::StartStatementImp}
		La classe \mclass{StartStatementImp} rappresenta uno statement di inizio di un contenuto da parte di un utente, che deve essere inviato ad un LRS. Tale classe implementa l'interfaccia \minterface{StartStatement} e estende \mclass{Statement} della libreria TinCanAndroid-Offline. I campi dello statement relativi a chi ha effettuato l'azione vengono riempiti usando un oggetto di tipo \minterface{UserDataAccess}, il quale permette di accedere ai dati dell'utente loggato. Il campo \textit{verb} viene inizializzato utilizzando la definizione del verbo \textit{inizialized}, disponibile all'URL \url{http://adlnet.gov/expapi/verbs/inizialized}. Infine i campi che definiscono il contesto dello statement e il campo \textit{object} vengono riempiti sfruttando i campi dati dell'oggetto \mclass{StartResult}, richiesto dal costruttore della classe. Le classi \mclass{PartialResulStatementImp} e \mclass{TotalResulStatementImp} hanno compiti analoghi e sono costruite in modo simile.

		\subsection{presenter::javascript\_communication::\\MyJavascriptInterfaceImp}
		La classe \mclass{MyJavascriptInterfaceImp} si occupa di ricevere i dati di fruizione di un utente da parte dello script Javascript. Tale classe, inoltre, si occupa di trasformare in statement questi dati e di inserirli nel database degli statement, utilizzando un oggetto \mclass{RSTinCanOfflineConnector}, classe della libreria TinCanAndroid-Offline. Ad ogni inserimento, inoltre, viene inviato un messaggio in broadcast impiegando un \mclass{LocalBroadcastManager}, classe del framework Android, in modo tale che le classi che sono in ascolto per i cambiamenti del database degli statement siano avvertite. Per fare ciò implementa l'interfaccia \minterface{MyJavascriptInterface}, i cui metodi che possono essere richiamati da JavaScript sono annotati con \textit{@JavascriptInterface}. Tale annotazione permette l'invocazione di metodi delle classi di Android da JavaScript, anche per le versioni uguali o inferiori ad Android 4.2(API level 18). Tale classe, infine, ha il compito di aggiornare le informazioni di fruizione dei contenuti xAPI dell'utente loggato, in base ai dati ricevuti. 

		\subsection{presenter::manager::DownloaderManagerImp}
		La classe \mclass{DownloaderManagerImp} si occupa del download delle informazioni relative ai contenuti da mostrare nell'applicazione e di renderli disponibili anche in assenza di connessione internet. Per permettere la fruizione di un determinato contenuto in modalità offline, le istanza di tale classe si connettono al server in cui il contenuto risiede per effettuare il download di alcuni file compressi. Tali file specificano le risorse necessarie per la riproduzione di un corso. Una volta scaricati, vengono decompressi e viene estratto dal loro interno un file in formato XML. Quest'ultimi contengono dei riferimenti a tutte le risorse di cui fare il download per permettere la riproduzione di un contenuto. Le informazioni presenti nei file XML vengono estratte utilizzando delle espressioni XPath.

		\subsection{presenter::manager::ProgressUpdateHandler}
		La classe \mclass{ProgressUpdateHandler} si occupa dell'aggiornamento di un'istanza della classe \mclass{DownloadProgressDialog} per mostrare a video lo stato di avanzamento del download di un contenuto. Tale classe estende la classe \mclass{Handler} del framework Android. Utilizzando tale classe è possibile, oltre che impostare la percentuale di completamento del download, definire il titolo che deve essere mostrato durante il download, nascondere l'alert, mostrare al completamento del download un messaggio di errore o di download avvenuto con successo.

		\subsection{presenter::receiver::InternetStateReceiverImp}
		La classe \mclass{InternetStateReceiver} si occupa di avvisare ad ogni variazione nella connettività ad internet del dispositivo tutti gli oggetti che implementano l'interfaccia \minterface{NetworkChangeListener}, che si sono registrati come ``listener''. Tale classe implementa l'interfaccia \mclass{InternetStateReceiver}, che espone i metodi per registrarsi e deregistrarsi come ``listener'', ed estende la classe astratta \mclass{BroadcastReceiver}, del framework Android, della quale implementa il metodo \textit{onReceive}, invocato ad ogni variazione nello stato della connessione ad Internet. Il funzionamento e lo scopo della classe \mclass{DatabaseStateReceiverImp} sono analoghi. 

		\subsection{presenter::MyApplication}
		La classe \mclass{MyApplication} estende la classe \mclass{Application} del framework Android e si occupa di fornire alcuni metodi statici di utilità. Questi metodi permettono di accedere al contesto di esecuzione, allo stato della connessione internet e alla componente necessaria per effettuare la dependency injection.

		\subsection{presenter::HomeActivityPresenterImp}
		La classe \mclass{HomeActivityPresenterImp} si occupa, interagendo con le componenti dei package \mpackage{model} e \mpackage{presenter}, del recupero delle informazioni che devono essere visualizzate dalla classe \mclass{HomaActivity} e della gestione delle richieste di tale classe, provenienti dall'interazione dell'utente con l'interfaccia grafica. In particolare si occupa di fornire i dati relativi a tutti i contenuti xAPI che devono essere riprodotti dall'applicazione, di gestire le richieste di download e rimozione di tali contenuti e della gestione del logout di un utente. \mclass{HomeActivityPresenterImp} implementa l'interfaccia \minterface{HomeActivityPresenter}. In modo analogo le classi \mclass{ContentSelectedPresenterImp}, \mclass{ImageAdapterPresenterImp} e \\ \mclass{ReportActivityPresenterImp} si occupano, rispettivamente, della gestione e del recupero delle informazioni che devono essere visualizzate per le classi \mclass{ContentAlertDialog}, \mclass{ImageAdpater} e \mclass{ReportActivity}.

		\subsection{view::DownloadProgressDialog}
		La classe \mclass{DownloadProgressDialog} si occupa di mostrare una barra che indica il completamento del download di un contenuto. Tale classe offre i metodi per mostrare e nascodere l'alert che contiene la barra del completamento, impostare il livello di completamento del download e per settare il titolo del contenuto di cui si sta effettuando il download. Tale classe è utilizzata, nell'applicazione, insieme alla classe \mclass{ProgressUpdateHandler}.

		\subsection{view::HomeActivity}
		La classe \mclass{HomeActivity} si occupa della gestione dell'interfaccia grafica dell'home page dell'applicazione. Tale classe ha il compito di mostrare i corretti oggetti grafici e di reagire alle interazioni dell'utente con l'interfaccia, richiamando i metodi di un'istanza della classe \mclass{HomeActivityPresenterImp} per la gestione della richiesta. In particolare tale classe mostra, con una disposizione a griglia, i corsi in formato xAPI che possono essere riprodotti utilizzando l'applicazione. Sui contenuti è possibile effettuare un tap, per accedere alla schermata che permette di avviare la riproduzione del contenuto e il download, oppure tenendo premuto su di essi è possibile selezionarli, per effettuare il download o la cancellazione di uno o più contenuti. Inoltre si occupa di visualizzare un menu per accedere all'area di report, ripristinare i contenuti cancellati e effettuare il logout.

\end{document}